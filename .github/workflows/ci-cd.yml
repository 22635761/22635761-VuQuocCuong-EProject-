name: CI/CD Pipeline with Docker

on:
  push:
    branches: [ main ]

jobs:
  verify-and-build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '18'
          
      - name: Verify Services Installation
        run: |
          echo "ğŸ”§ Verifying services can be installed and built..."
          
          # Verify Auth Service
          cd auth
          npm install
          echo "âœ… Auth service - Installation successful"
          
          # Verify Product Service  
          cd ../product
          npm install
          echo "âœ… Product service - Installation successful"
          
          # Verify Order Service
          cd ../order
          npm install
          echo "âœ… Order service - Installation successful"
          
          # Verify API Gateway
          cd ../api-gateway
          npm install
          echo "âœ… API Gateway - Installation successful"
          
          echo "ğŸ‰ All services verified successfully!"

      - name: Build Docker Images
        run: |
          echo "ğŸ³ Building Docker images for all services..."
          
          # Build Docker images
          docker build -t auth-service ./auth
          docker build -t product-service ./product
          docker build -t order-service ./order
          docker build -t api-gateway ./api-gateway
          
          echo "âœ… All Docker images built successfully!"
          
      - name: Verify Docker Images
        run: |
          echo "ğŸ“‹ Listing all Docker images:"
          docker images
          echo "âœ… Docker images ready for deployment"